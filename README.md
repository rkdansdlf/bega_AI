
<div id="top"> <!-- HEADER STYLE: CLASSIC --> <div align="center">

# AI SERVICE

<em>BEGA í”Œë«í¼ì˜ ì§€ëŠ¥í˜• ê¸°ëŠ¥</em>

<!-- BADGES --> <img src="https://img.shields.io/github/last-commit/737genie/ai-service?style=flat&logo=git&logoColor=white&color=0080ff" alt="last-commit"> <img src="https://img.shields.io/github/languages/top/737genie/ai-service?style=flat&color=0080ff" alt="repo-top-language"> <img src="https://img.shields.io/github/languages/count/737genie/ai-service?style=flat&color=0080ff" alt="repo-language-count">

<em>ì‚¬ìš©ëœ ê¸°ìˆ  ìŠ¤íƒ:</em>

<img src="https://img.shields.io/badge/Python-3776AB.svg?style=flat&logo=Python&logoColor=white" alt="Python"> <img src="https://img.shields.io/badge/FastAPI-009688.svg?style=flat&logo=FastAPI&logoColor=white" alt="FastAPI"> <img src="https://img.shields.io/badge/OpenAI-412991.svg?style=flat&logo=OpenAI&logoColor=white" alt="OpenAI"> <img src="https://img.shields.io/badge/Docker-2496ED.svg?style=flat&logo=Docker&logoColor=white" alt="Docker"> <img src="https://img.shields.io/badge/Selenium-43B02A.svg?style=flat&logo=Selenium&logoColor=white" alt="Selenium"> <img src="https://img.shields.io/badge/Amazon%20AWS-232F3E.svg?style=flat&logo=Amazon-AWS&logoColor=white" alt="AWS"> <img src="https://img.shields.io/badge/Nginx-009639.svg?style=flat&logo=NGINX&logoColor=white" alt="Nginx"> </div> <br>

----------

## ëª©ì°¨

-   [ê°œìš”](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EA%B0%9C%EC%9A%94)
-   [ì£¼ìš” ê¸°ëŠ¥](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EC%A3%BC%EC%9A%94-%EA%B8%B0%EB%8A%A5)
-   [í”„ë¡œì íŠ¸ êµ¬ì¡°](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B5%AC%EC%A1%B0)
-   [ì•„í‚¤í…ì²˜](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EC%95%84%ED%82%A4%ED%85%8D%EC%B2%98)
-   [ì‹œì‘í•˜ê¸°](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EC%8B%9C%EC%9E%91%ED%95%98%EA%B8%B0)
    -   [ì‚¬ì „ ìš”êµ¬ì‚¬í•­](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EC%82%AC%EC%A0%84-%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD)
    -   [ì„¤ì¹˜](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EC%84%A4%EC%B9%98)
    -   [í™˜ê²½ ì„¤ì •](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95)
    -   [ì‹¤í–‰](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EC%8B%A4%ED%96%89)
-   [API ë¬¸ì„œ](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#api-%EB%AC%B8%EC%84%9C)
-   [RAG íë¦„](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#rag-%ED%9D%90%EB%A6%84)
-   [ë²¡í„° ìŠ¤í‚¤ë§ˆ ë° ë°ì´í„° ìˆ˜ì§‘](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EB%B2%A1%ED%84%B0-%EC%8A%A4%ED%82%A4%EB%A7%88-%EB%B0%8F-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%88%98%EC%A7%91)
-   [ë°°í¬](https://claude.ai/chat/b41b67c5-88a7-4ded-a9a2-4bed83ecd0c6#%EB%B0%B0%ED%8F%AC)

----------

## ê°œìš”

AI ServiceëŠ” BEGA(Baseball Guide) í”Œë«í¼ì˜ ì§€ëŠ¥í˜• ê¸°ëŠ¥ì„ ì§€ì›í•˜ëŠ” ë²¡í„° ê¸°ë°˜ RAG(ê²€ìƒ‰ ì¦ê°• ìƒì„±) ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. KBO ë°ì´í„°ë² ì´ìŠ¤ ìœ„ì— ìµœì‹  LLM ì œê³µì(OpenRouter ë˜ëŠ” Google Gemini)ë¥¼ ê³„ì¸µí™”í•˜ì—¬, pgvector ì €ì¥ì†Œ, SSE ìŠ¤íŠ¸ë¦¬ë° ì±„íŒ…, ê²½ëŸ‰ ì˜ë„ ë¼ìš°í„°ë¥¼ í†µí•´ ì•¼êµ¬ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

**ì™œ AI Serviceì¸ê°€?**

ì´ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” ë‹¤ìŒì„ í†µí•´ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚µë‹ˆë‹¤:

-   ğŸ¤ **ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜:** OpenAI Whisper ê¸°ë°˜ í•œêµ­ì–´ ìŒì„± ì¸ì‹
-   ğŸ¤– **RAG ê¸°ë°˜ ì±—ë´‡:** ê²€ìƒ‰ ì¦ê°• ìƒì„±ìœ¼ë¡œ ì •í™•í•œ ì•¼êµ¬ ì •ë³´ ì œê³µ
-   ğŸ” **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰:** pgvector + FTS(Full-Text Search) ê²°í•©
-   ğŸ“Š **ì„¸ì´ë²„ë©”íŠ¸ë¦­ìŠ¤:** ERA-, wRC+ ë“± ê³ ê¸‰ ì•¼êµ¬ ì§€í‘œ ê³„ì‚°
-   âš¡ **SSE ìŠ¤íŠ¸ë¦¬ë°:** ì‹¤ì‹œê°„ ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë°
-   ğŸ§  **ì˜ë„ ë¼ìš°íŒ…:** ì§ˆë¬¸ ì˜ë„ì— ë”°ë¥¸ ìµœì í™”ëœ ë‹µë³€ ìƒì„±

----------

## ì£¼ìš” ê¸°ëŠ¥

### RAG ì‹œìŠ¤í…œ

-   **ê²€ìƒ‰ ì¦ê°• ìƒì„± (RAG)**
    
    -   HyDE(Hypothetical Document Embeddings) ê¸°ë²• ì ìš©
    -   pgvector ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰
    -   FTS(Full-Text Search) í‚¤ì›Œë“œ ê²€ìƒ‰
    -   í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ìœ¼ë¡œ ì •í™•ë„ í–¥ìƒ
-   **ì˜ë„ ë¼ìš°íŒ…**
    
    -   ê·œì¹™ ê¸°ë°˜ ì§ˆë¬¸ ì˜ë„ ë¶„ë¥˜
    -   í†µê³„ ì¡°íšŒ, ìˆœìœ„ ì§ˆë¬¸, ìš©ì–´ ì„¤ëª… ë“± ë¶„ë¥˜
    -   ì˜ë„ë³„ ìµœì í™”ëœ ê²€ìƒ‰ ì „ëµ
-   **ì»¨í…ìŠ¤íŠ¸ ìƒì„±**
    
    -   ì›ë³¸ ë°ì´í„°ë¥¼ LLM ì¹œí™”ì  í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
    -   ì„¸ì´ë²„ë©”íŠ¸ë¦­ìŠ¤ ì§€í‘œ ë™ì  ê³„ì‚° (ERA-, wRC+ ë“±)
    -   ì„ ìˆ˜ë³„ ìˆœìœ„ ë° ë¹„êµ ë¶„ì„

### AI ê¸°ëŠ¥

-   **ìŒì„±-í…ìŠ¤íŠ¸ ë³€í™˜**
    
    -   OpenAI Whisper API í†µí•©
    -   í•œêµ­ì–´ ìŒì„± ì¸ì‹
    -   ë‹¤ì–‘í•œ ì˜¤ë””ì˜¤ í¬ë§· ì§€ì›
-   **ì±—ë´‡**
    
    -   OpenRouter / Google Gemini LLM ì§€ì›
    -   SSE ìŠ¤íŠ¸ë¦¬ë° ì‹¤ì‹œê°„ ì‘ë‹µ
    -   ëŒ€í™” ê¸°ë¡ ê´€ë¦¬
    -   ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ë‹µë³€

### ë°ì´í„° ì„œë¹„ìŠ¤

-   **KBO ë°ì´í„° í¬ë¡¤ë§**
    
    -   Selenium ê¸°ë°˜ ì›¹ ìŠ¤í¬ë˜í•‘
    -   ì¼ì • ë° ê²°ê³¼ íŒŒì‹±
    -   ìë™í™”ëœ ë°ì´í„° ì—…ë°ì´íŠ¸
-   **ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤**
    
    -   pgvector í™•ì¥ ê¸°ëŠ¥ í™œìš©
    -   ë‹¤ì–‘í•œ ì„ë² ë”© í”„ë¡œë°”ì´ë” ì§€ì›
    -   íš¨ìœ¨ì ì¸ ì²­í¬ ê´€ë¦¬

----------

## í”„ë¡œì íŠ¸ êµ¬ì¡°

```
AI/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                 # FastAPI íŒ©í† ë¦¬
â”‚   â”œâ”€â”€ config.py               # ì„¤ì • (LLM/ì„ë² ë”©, DB)
â”‚   â”œâ”€â”€ deps.py                 # ì˜ì¡´ì„± í—¬í¼
â”‚   â”œâ”€â”€ core/                   # RAG êµ¬ì„± ìš”ì†Œ
â”‚   â”‚   â”œâ”€â”€ chunking.py         # í…ìŠ¤íŠ¸ ë¶„í• 
â”‚   â”‚   â”œâ”€â”€ embeddings.py       # ì„ë² ë”© ìƒì„±
â”‚   â”‚   â”œâ”€â”€ kbo_metrics.py      # ì„¸ì´ë²„ë©”íŠ¸ë¦­ìŠ¤ ê³„ì‚°
â”‚   â”‚   â”œâ”€â”€ prompts.py          # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
â”‚   â”‚   â”œâ”€â”€ rag.py              # RAG íŒŒì´í”„ë¼ì¸
â”‚   â”‚   â”œâ”€â”€ retrieval.py        # ê²€ìƒ‰ ë¡œì§
â”‚   â”‚   â””â”€â”€ renderers/          # ë°ì´í„° ë Œë”ëŸ¬
â”‚   â”œâ”€â”€ ml/
â”‚   â”‚   â””â”€â”€ intent_router.py    # ì˜ë„ ë¶„ë¥˜ê¸°
â”‚   â”œâ”€â”€ routers/                # API ë¼ìš°í„°
â”‚   â”‚   â”œâ”€â”€ chat_stream.py      # ì±„íŒ… ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â”œâ”€â”€ search.py           # ê²€ìƒ‰ ì—”ë“œí¬ì¸íŠ¸
â”‚   â”‚   â””â”€â”€ ingest.py           # ë°ì´í„° ìˆ˜ì§‘ API
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ baseball_agent.py
â”‚   â”‚   â””â”€â”€ tool_caller.py
â”‚   â”œâ”€â”€ db/                     # DB ìŠ¤í‚¤ë§ˆ
â”‚   â”‚   â”œâ”€â”€ schema.sql
â”‚   â”‚   â””â”€â”€ queries.sql
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ database_query.py
â”‚       â”œâ”€â”€ game_query.py
â”‚       â””â”€â”€ regulation_query.py
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ ingest_from_kbo.py      # ëŒ€ëŸ‰ ë°ì´í„° ìˆ˜ì§‘
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ kbo_metrics_explained.md
â”‚   â””â”€â”€ kbo_regulations/
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â””â”€â”€ .env.example

```

----------

## ì•„í‚¤í…ì²˜

### ê¸°ìˆ  ìŠ¤íƒ

-   **í”„ë ˆì„ì›Œí¬:** FastAPI
-   **ì–¸ì–´:** Python 3.11+
-   **AI/ML:** OpenAI API (Whisper), OpenRouter, Google Gemini
-   **ì„ë² ë”©:** OpenRouter, Gemini, OpenAI
-   **ì›¹ ìŠ¤í¬ë˜í•‘:** Selenium
-   **ë°ì´í„°ë² ì´ìŠ¤:** PostgreSQL + pgvector
-   **ìŠ¤íŠ¸ë¦¬ë°:** sse-starlette
-   **ì›¹ ì„œë²„:** Nginx (ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œ)
-   **ë°°í¬:** AWS EC2
-   **ì»¨í…Œì´ë„ˆí™”:** Docker

### ì‹œìŠ¤í…œ ì„¤ê³„

```
í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
    â†“ HTTPS
Nginx (EC2:443)
    â†“
FastAPI Application (8001)
    â†“
â”œâ”€â”€ ì˜ë„ ë¼ìš°í„° (Intent Router)
â”œâ”€â”€ RAG íŒŒì´í”„ë¼ì¸
â”‚   â”œâ”€â”€ HyDE ì¿¼ë¦¬ ìƒì„±
â”‚   â”œâ”€â”€ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (pgvector + FTS)
â”‚   â”œâ”€â”€ ì»¨í…ìŠ¤íŠ¸ ìƒì„± (Renderers)
â”‚   â””â”€â”€ LLM ë‹µë³€ ìƒì„±
â”œâ”€â”€ OpenRouter / Gemini API
â””â”€â”€ PostgreSQL + pgvector
    â””â”€â”€ rag_chunks (ë²¡í„° ì €ì¥ì†Œ)

```

----------

## ì‹œì‘í•˜ê¸°

### ì‚¬ì „ ìš”êµ¬ì‚¬í•­

ì´ í”„ë¡œì íŠ¸ëŠ” ë‹¤ìŒ ì¢…ì†ì„±ì„ í•„ìš”ë¡œ í•©ë‹ˆë‹¤:

-   **Python:** 3.11 ì´ìƒ
-   **íŒ¨í‚¤ì§€ ë§¤ë‹ˆì €:** pip
-   **ë°ì´í„°ë² ì´ìŠ¤:** PostgreSQL 14+ (pgvector í™•ì¥ í•„ìš”)
-   **ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„:** Docker (ì„ íƒì‚¬í•­)
-   **ì›¹ ë“œë¼ì´ë²„:** ChromeDriver (í¬ë¡¤ë§ìš©)

### ì„¤ì¹˜

ì†ŒìŠ¤ì—ì„œ AI serviceë¥¼ ë¹Œë“œí•˜ê³  ì¢…ì†ì„±ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤:

1.  **ì €ì¥ì†Œ í´ë¡ :**
    
    ```sh
    â¯ git clone https://github.com/737genie/ai-service
    ```
    
2.  **í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ë¡œ ì´ë™:**
    
    ```sh
    â¯ cd ai-service
    ```
    
3.  **ê°€ìƒ í™˜ê²½ ìƒì„± ë° í™œì„±í™”:**
    
    ```sh
    â¯ python -m venv .venv
    â¯ source .venv/bin/activate  # Windows: .venv\Scripts\activate
    ```
    
4.  **ì¢…ì†ì„± ì„¤ì¹˜:**
    
    ```sh
    â¯ pip install -r requirements.txt
    ```
    

### í™˜ê²½ ì„¤ì •

1.  **.env íŒŒì¼ ìƒì„±:**
    
    `.env.example` íŒŒì¼ì„ ë³µì‚¬í•˜ì—¬ ì‹¤ì œ ê°’ìœ¼ë¡œ ì±„ì›Œì£¼ì„¸ìš”:
    
    ```env
    # --- LLM/ì„ë² ë”© í”„ë¡œë°”ì´ë” ì„ íƒ ---
    LLM_PROVIDER=openrouter          # openrouter(ê¸°ë³¸), gemini
    EMBED_PROVIDER=openrouter        # openrouter(ê¸°ë³¸), gemini, openai, hf, local
    
    # --- OpenRouter ì„¤ì • (ê¸°ë³¸) ---
    OPENROUTER_API_KEY=sk-or-...
    OPENROUTER_MODEL=openai/gpt-4o-mini
    OPENROUTER_EMBED_MODEL=openai/text-embedding-3-small
    OPENROUTER_REFERER=https://begabaseball.xyz
    OPENROUTER_APP_TITLE=BEGA ì±—ë´‡
    
    # --- Google Gemini ì„¤ì • (ì„ íƒ) ---
    # GEMINI_API_KEY=...
    # GEMINI_MODEL=gemini-1.5-flash
    # GEMINI_EMBED_MODEL=text-embedding-004
    
    # --- OpenAI ì„¤ì • (ì„ íƒ) ---
    # OPENAI_API_KEY=sk-...
    # OPENAI_EMBED_MODEL=text-embedding-3-small
    
    # --- ë°ì´í„°ë² ì´ìŠ¤ ---
    SUPABASE_DB_URL=postgresql://user:pass@host:5432/db
    
    # --- ê³µí†µ ì„¤ì • ---
    DEFAULT_SEARCH_LIMIT=15
    MAX_OUTPUT_TOKENS=1024
    ```
    
2.  **pgvector í™•ì¥ ì„¤ì¹˜:**
    
    PostgreSQLì—ì„œ pgvector í™•ì¥ì„ í™œì„±í™”í•©ë‹ˆë‹¤:
    
    ```sql
    CREATE EXTENSION IF NOT EXISTS vector;
    ```
    

### ì‹¤í–‰

í”„ë¡œì íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤:

**Python ì‚¬ìš©:**

```sh
â¯ PYTHONPATH=. uvicorn app.main:app --host 0.0.0.0 --port 8001 --reload
```

**Docker ì‚¬ìš©:**

```sh
â¯ docker build -t 737genie/ai-service .
â¯ docker run -p 8001:8001 737genie/ai-service
```

APIëŠ” `http://localhost:8001`ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤

----------

## API ë¬¸ì„œ

### ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡


### ì±—ë´‡ ì—”ë“œí¬ì¸íŠ¸ 
``` 
POST /ai/chat/completion - RAG íŒŒì´í”„ë¼ì¸ JSON ì‘ë‹µ 
POST /ai/chat/stream     - SSE ìŠ¤íŠ¸ë¦¼ ì±„íŒ… ì‘ë‹µ 
GET /ai/search           - ìƒìœ„ Kê°œ ê²€ìƒ‰ëœ ì²­í¬ ì¡°íšŒ 
POST /ai/ingest          - ë‹¨ì¼ ë¬¸ì„œ ì—…ì„œíŠ¸ 
GET /ai/health           - ê¸°ë³¸ í—¬ìŠ¤ ì²´í¬ 
``` 
**ìš”ì²­:** 
```
json { 
	"message": "ì‚¬ìš©ì ì§ˆë¬¸", 
	"conversation_id": "optional_id", 
	"context": "optional_context" 
	} 
``` 
**ì‘ë‹µ:** 
```
json { 
	"response": "AI ì‘ë‹µ", 
	"sources": ["ì¶œì²˜1", "ì¶œì²˜2"], 
	"conversation_id": "id" 
	} 
``` 
### ë°ì´í„° í¬ë¡¤ëŸ¬ 
``` 
crawlers.py 
```

 ### ì„ë² ë”© 
 ``` 
 embeddings.py 
 ```

### cURL ì˜ˆì‹œ

```bash
# ì±„íŒ… ì™„ì„± ìš”ì²­
curl -X POST http://localhost:8001/chat/completion \
  -H "Content-Type: application/json" \
  -d '{"question":"2024ë…„ LGì—ì„œ OPSê°€ ê°€ì¥ ë†’ì€ ì„ ìˆ˜ 5ëª… ì•Œë ¤ì¤˜"}'

# ê²€ìƒ‰
curl "http://localhost:8001/search/?q=ê¹€ë„ì˜&limit=5"

# í—¬ìŠ¤ ì²´í¬
curl http://localhost:8001/health

```

----------

## RAG íë¦„

BEGA AI Serviceì˜ RAG(ê²€ìƒ‰ ì¦ê°• ìƒì„±) íŒŒì´í”„ë¼ì¸ì€ ë‹¤ìŒ 4ë‹¨ê³„ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:

### 1. ì˜ë„ ë¼ìš°íŒ… (Intent Routing)

`app/ml/intent_router.py`ì˜ ê·œì¹™ ê¸°ë°˜ ë¶„ë¥˜ê¸°ê°€ ì‚¬ìš©ì ì§ˆë¬¸ì˜ ì˜ë„ë¥¼ íŒŒì•…í•©ë‹ˆë‹¤:

-   ë‹¨ìˆœ í†µê³„ ì¡°íšŒ
-   ìˆœìœ„ ì§ˆë¬¸
-   ìš©ì–´ ì„¤ëª…
-   ë¹„êµ ë¶„ì„

### 2. ê²€ìƒ‰ (Retrieval)

**HyDE(Hypothetical Document Embeddings) ê¸°ë²•:**

-   ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ê°€ìƒì˜ ë¬¸ì„œë¥¼ ìƒì„±í•˜ì—¬ ê²€ìƒ‰ í’ˆì§ˆ í–¥ìƒ

**í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰:**

-   **ë²¡í„° ê²€ìƒ‰**: pgvectorë¥¼ ì‚¬ìš©í•œ ì˜ë¯¸ë¡ ì  ìœ ì‚¬ë„ ê²€ìƒ‰
-   **FTS ê²€ìƒ‰**: Full-Text Searchë¥¼ í†µí•œ í‚¤ì›Œë“œ ë§¤ì¹­
-   ë‘ ë°©ì‹ì„ ê²°í•©í•˜ì—¬ ì •í™•ë„ ìµœëŒ€í™”

ê²€ìƒ‰ ëŒ€ìƒ:

-   KBO ë°ì´í„°ë² ì´ìŠ¤ì˜ í†µê³„ ë°ì´í„°
-   `docs/kbo_metrics_explained.md` ë“± ì •ì  ë¬¸ì„œ

### 3. ì»¨í…ìŠ¤íŠ¸ ìƒì„± (Context Generation)

`app/core/renderers/`ì˜ ë Œë”ëŸ¬ë¥¼ í†µí•´ ê²€ìƒ‰ëœ ë°ì´í„°ë¥¼ LLM ì¹œí™”ì  í…ìŠ¤íŠ¸ë¡œ ë³€í™˜:

**ì˜ˆì‹œ:**

```python
# ì›ë³¸ ë°ì´í„°
{"player": "ê¹€ë„ì˜", "avg": 0.350, "hr": 20}

# ë Œë”ë§ í›„
"2024ë…„ ê¹€ë„ì˜ì€ 0.350ì˜ íƒ€ìœ¨ê³¼ 20ê°œì˜ í™ˆëŸ°ì„ ê¸°ë¡í–ˆìŠµë‹ˆë‹¤."

```

**ì„¸ì´ë²„ë©”íŠ¸ë¦­ìŠ¤ ê³„ì‚°:**

-   `app/core/kbo_metrics.py`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³ ê¸‰ ì§€í‘œ ê³„ì‚°
-   ERA-, wRC+, OPS+ ë“±
-   ì„ ìˆ˜ë³„ ìˆœìœ„ ìë™ ì‚°ì¶œ

### 4. ë‹µë³€ ìƒì„± (Generation)

ìµœì¢… í”„ë¡¬í”„íŠ¸ êµ¬ì„±:

-   ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ (`app/core/prompts.py`)
-   ì´ì „ ëŒ€í™” ê¸°ë¡
-   ìƒì„±ëœ ì»¨í…ìŠ¤íŠ¸

ì„ íƒëœ LLM(OpenRouter/Gemini)ì´ ë‹µë³€ì„ ìƒì„±í•˜ê³  `sse-starlette`ë¥¼ í†µí•´ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°

----------

## ë²¡í„° ìŠ¤í‚¤ë§ˆ ë° ë°ì´í„° ìˆ˜ì§‘

### ìŠ¤í‚¤ë§ˆ ì„¤ì •

`app/db/schema.sql` íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ `rag_chunks` í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤:

```bash
psql $SUPABASE_DB_URL -f app/db/schema.sql
```

### ì´ˆê¸° ë°ì´í„° ìˆ˜ì§‘

`scripts/ingest_from_kbo.py` ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‚¬ìš©í•˜ì—¬ KBO ë°ì´í„°ë¥¼ ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ì— ìˆ˜ì§‘í•©ë‹ˆë‹¤:

```bash
# AI ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
PYTHONPATH=. .venv/bin/python scripts/ingest_from_kbo.py \
  --tables player_season_batting player_season_pitching kbo_metrics_explained
```

**ìŠ¤í¬ë¦½íŠ¸ ê¸°ëŠ¥:**

1.  í†µê³„ ë°ì´í„°ë¥¼ LLM ì¹œí™”ì  í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
2.  í…ìŠ¤íŠ¸ë¥¼ ì ì ˆí•œ í¬ê¸°ì˜ ì²­í¬ë¡œ ë¶„í• 
3.  ê° ì²­í¬ì˜ ì„ë² ë”© ìƒì„±
4.  `rag_chunks` í…Œì´ë¸”ì— ì—…ì„œíŠ¸

### ì˜¤í”„ë¼ì¸ ê°œë°œ

ì„ë² ë”© API í˜¸ì¶œ ì—†ì´ ê°œë°œí•˜ë ¤ë©´:

```env
EMBED_PROVIDER=local
```

ë¡œì»¬ ëª¨ë“œì—ì„œëŠ” ê²°ì •ë¡ ì ì¸ ì˜ì‚¬(pseudo) ë²¡í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

----------

## ë°°í¬

### AWS EC2 ë°°í¬

1.  **ì„œë²„ ì„¤ì •:**
    
    ```sh
    # ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
    sudo apt update && sudo apt upgrade -y
    
    # Python ì„¤ì¹˜
    sudo apt install python3.11 python3-pip python3-venv -y
    
    # Seleniumì„ ìœ„í•œ Chrome ë° ChromeDriver ì„¤ì¹˜ (í¬ë¡¤ë§ìš©)
    wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
    sudo apt install ./google-chrome-stable_current_amd64.deb
    ```
    
2.  **PostgreSQL pgvector ì„¤ì •:**
    
    ```sh
    # PostgreSQL ì„¤ì¹˜ (ì´ë¯¸ ì„¤ì¹˜ë˜ì–´ ìˆë‹¤ë©´ ìƒëµ)
    sudo apt install postgresql postgresql-contrib
    
    # pgvector í™•ì¥ ì„¤ì¹˜
    sudo apt install postgresql-14-pgvector
    
    # PostgreSQLì—ì„œ í™•ì¥ í™œì„±í™”
    sudo -u postgres psql -d your_database -c "CREATE EXTENSION IF NOT EXISTS vector;"
    ```
    
3.  **ì• í”Œë¦¬ì¼€ì´ì…˜ ì„¤ì¹˜:**
    
    ```sh
    cd /var/www/ai-service
    python3 -m venv .venv
    source .venv/bin/activate
    pip install -r requirements.txt
    ```
    
4.  **Nginx ì„¤ì •:**
    
    ```nginx
    server {
        listen 443 ssl;
        server_name ai.begabaseball.xyz;
        
        ssl_certificate /etc/letsencrypt/live/ai.begabaseball.xyz/fullchain.pem;
        ssl_certificate_key /etc/letsencrypt/live/ai.begabaseball.xyz/privkey.pem;
        
        # SSE ìŠ¤íŠ¸ë¦¬ë°ì„ ìœ„í•œ ì„¤ì •
        location / {
            proxy_pass http://localhost:8001;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            
            # SSE íƒ€ì„ì•„ì›ƒ ì„¤ì •
            proxy_read_timeout 3600s;
            proxy_connect_timeout 3600s;
            proxy_send_timeout 3600s;
            
            # SSE ë²„í¼ë§ ë¹„í™œì„±í™”
            proxy_buffering off;
            proxy_cache off;
        }
    }
    ```
    
5.  **systemd ì„œë¹„ìŠ¤ ì„¤ì •:**
    
    ```ini
    # /etc/systemd/system/ai-service.service
    [Unit]
    Description=BEGA AI Service
    After=network.target postgresql.service
    
    [Service]
    Type=simple
    User=www-data
    WorkingDirectory=/var/www/ai-service
    Environment="PATH=/var/www/ai-service/.venv/bin"
    Environment="PYTHONPATH=/var/www/ai-service"
    ExecStart=/var/www/ai-service/.venv/bin/uvicorn app.main:app --host 0.0.0.0 --port 8001
    Restart=always
    
    [Install]
    WantedBy=multi-user.target
    ```
    
6.  **ì„œë¹„ìŠ¤ ì‹œì‘:**
    
    ```sh
    sudo systemctl daemon-reload
    sudo systemctl enable ai-service
    sudo systemctl start ai-service
    sudo systemctl status ai-service
    ```
    

### Docker Compose ë°°í¬

```yaml
version: '3.8'
services:
  ai-service:
    build: .
    ports:
      - "8001:8001"
    environment:
      - LLM_PROVIDER=${LLM_PROVIDER}
      - EMBED_PROVIDER=${EMBED_PROVIDER}
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - SUPABASE_DB_URL=${SUPABASE_DB_URL}
    volumes:
      - ./data:/app/data
      - ./docs:/app/docs
    restart: unless-stopped
    depends_on:
      - postgres
    
  postgres:
    image: pgvector/pgvector:pg14
    environment:
      - POSTGRES_DB=bega
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data:
```

**ì‹¤í–‰:**

```sh
docker-compose up -d
```

### ì„±ëŠ¥ ìµœì í™”

-   **ìºì‹±:** ë¹ˆë²ˆí•œ ì¿¼ë¦¬ ê²°ê³¼ë¥¼ ìºì‹±
-   **ë¹„ë™ê¸° ì²˜ë¦¬:** FastAPIì˜ ë¹„ë™ê¸° ê¸°ëŠ¥ í™œìš©
-   **ë°°ì¹˜ ì„ë² ë”©:** ì—¬ëŸ¬ ì²­í¬ë¥¼ í•œ ë²ˆì— ì„ë² ë”© ìƒì„±
-   **ì—°ê²° í’€ë§:** PostgreSQL ì—°ê²° í’€ ìµœì í™”
-   **ëª¨ë‹ˆí„°ë§:**
    -   ë¡œê¹…: Python logging ëª¨ë“ˆ

### í”„ë¡œë•ì…˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

-   [ ] í™˜ê²½ ë³€ìˆ˜ ë³´ì•ˆ ì„¤ì •
-   [ ] SSL ì¸ì¦ì„œ ì„¤ì¹˜ (Let's Encrypt)
-   [ ] pgvector ì¸ë±ìŠ¤ ìµœì í™”
-   [ ] API ë ˆì´íŠ¸ ë¦¬ë¯¸íŒ… ì„¤ì •
-   [ ] ë¡œê·¸ ë¡œí…Œì´ì…˜ ì„¤ì •
-   [ ] ë°±ì—… ì „ëµ ìˆ˜ë¦½
-   [ ] ëª¨ë‹ˆí„°ë§ ì•Œë¦¼ ì„¤ì •
-   [ ] SSE íƒ€ì„ì•„ì›ƒ íŠœë‹

### ì°¸ê³  ì‚¬í•­

-   **ëŒ€ëŸ‰ ë°ì´í„° ìˆ˜ì§‘**: `scripts/ingest_from_kbo.py`ë¥¼ í…œí”Œë¦¿ìœ¼ë¡œ ì‚¬ìš©
-   **ì˜¤í”„ë¼ì¸ ê°œë°œ**: `EMBED_PROVIDER=local`ë¡œ ì„¤ì •í•˜ì—¬ API í˜¸ì¶œ ì—†ì´ ê°œë°œ ê°€ëŠ¥
-   **SSE í”„ë¡ì‹œ**: Nginx ì„¤ì •ì—ì„œ ë²„í¼ë§ê³¼ íƒ€ì„ì•„ì›ƒ ê·œì¹™ ì£¼ì˜
-   **ì„ë² ë”© í”„ë¡œë°”ì´ë”**: ìš©ë„ì— ë§ê²Œ OpenRouter, Gemini, OpenAI ì¤‘ ì„ íƒ

----------

<div align="left"><a href="#top">â¬† ëŒì•„ê°€ê¸°</a></div>

----------
